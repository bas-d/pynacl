

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Secret Key Encryption &mdash; PyNaCl 1.4.0.dev1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Digital Signatures" href="signing.html" />
    <link rel="prev" title="Public Key Encryption" href="public.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PyNaCl
          

          
          </a>

          
            
            
              <div class="version">
                14
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="public.html">Public Key Encryption</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Secret Key Encryption</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#key">Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nonce">Nonce</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reference">Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#algorithm-details">Algorithm details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="signing.html">Digital Signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="hashing.html">Hashing</a></li>
<li class="toctree-l1"><a class="reference internal" href="password_hashing.html">Password hashing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="encoding.html">Encoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Api Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/hash.html">nacl.hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pwhash.html">nacl.pwhash</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/hashlib.html">nacl.hashlib</a></li>
</ul>
<p class="caption"><span class="caption-text">The PyNaCl open source project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="doing-a-release.html">Doing A Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="vectors/index.html">Reference vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyNaCl</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Secret Key Encryption</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/secret.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="secret-key-encryption">
<h1>Secret Key Encryption<a class="headerlink" href="#secret-key-encryption" title="Permalink to this headline">¶</a></h1>
<p>Secret key encryption (also called symmetric key encryption) is analogous to a
safe. You can store something secret through it and anyone who has the key can
open it and view the contents. <a class="reference internal" href="#nacl.secret.SecretBox" title="nacl.secret.SecretBox"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecretBox</span></code></a> functions as
just such a safe, and like any good safe any attempts to tamper with the
contents are easily detected.</p>
<p>Secret key encryption allows you to store or transmit data over insecure
channels without leaking the contents of that message, nor anything about it
other than the length.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nacl.secret</span>
<span class="kn">import</span> <span class="nn">nacl.utils</span>

<span class="c1"># This must be kept secret, this is the combination to your safe</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">nacl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nacl</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">SecretBox</span><span class="o">.</span><span class="n">KEY_SIZE</span><span class="p">)</span>

<span class="c1"># This is your safe, you can use it to encrypt or decrypt messages</span>
<span class="n">box</span> <span class="o">=</span> <span class="n">nacl</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">SecretBox</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="c1"># This is our message to send, it must be a bytestring as SecretBox will</span>
<span class="c1">#   treat it as just a binary blob of data.</span>
<span class="n">message</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;The president will be exiting through the lower levels&quot;</span>
</pre></div>
</div>
<p>PyNaCl can automatically generate a random nonce for us, making the encryption
very simple:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Encrypt our message, it will be exactly 40 bytes longer than the</span>
<span class="c1">#   original message as it stores authentication information and the</span>
<span class="c1">#   nonce alongside it.</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">NONCE_SIZE</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">MACBYTES</span>
</pre></div>
</div>
<p>However, if we need to use an explicit nonce, it can be passed along with the
message:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a nonce, it *MUST* only be used once, but it is not considered</span>
<span class="c1">#   secret and can be transmitted or stored alongside the ciphertext. A</span>
<span class="c1">#   good source of nonces are just sequences of 24 random bytes.</span>
<span class="n">nonce</span> <span class="o">=</span> <span class="n">nacl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nacl</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">SecretBox</span><span class="o">.</span><span class="n">NONCE_SIZE</span><span class="p">)</span>

<span class="n">encrypted</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">nonce</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need to get the ciphertext and the authentication data
without the nonce, you can get the <cite>ciphertext</cite> attribute of the
<a class="reference internal" href="utils.html#nacl.utils.EncryptedMessage" title="nacl.utils.EncryptedMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">EncryptedMessage</span></code></a> instance returned by
<a class="reference internal" href="#nacl.secret.SecretBox.encrypt" title="nacl.secret.SecretBox.encrypt"><code class="xref py py-meth docutils literal notranslate"><span class="pre">encrypt()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">nonce</span> <span class="o">=</span> <span class="n">nacl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nacl</span><span class="o">.</span><span class="n">secret</span><span class="o">.</span><span class="n">SecretBox</span><span class="o">.</span><span class="n">NONCE_SIZE</span><span class="p">)</span>

<span class="n">encrypted</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">nonce</span><span class="p">)</span>

<span class="c1"># since we are transmitting the nonce by some other means,</span>
<span class="c1"># we just need to get the ciphertext and authentication data</span>

<span class="n">ctext</span> <span class="o">=</span> <span class="n">encrypted</span><span class="o">.</span><span class="n">ciphertext</span>

<span class="c1"># ctext is just nacl.secret.SecretBox.MACBYTES longer</span>
<span class="c1"># than the original message</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctext</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">MACBYTES</span>
</pre></div>
</div>
<p>Finally, the message is decrypted (regardless of how the nonce was generated):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Decrypt our message, an exception will be raised if the encryption was</span>
<span class="c1">#   tampered with or there was otherwise an error.</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">plaintext</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The president will be exiting through the lower levels
</pre></div>
</div>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="key">
<h3>Key<a class="headerlink" href="#key" title="Permalink to this headline">¶</a></h3>
<p>The 32 bytes key given to <a class="reference internal" href="#nacl.secret.SecretBox" title="nacl.secret.SecretBox"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecretBox</span></code></a> must be kept secret.
It is the combination to your “safe” and anyone with this key will be able to
decrypt the data, or encrypt new data.</p>
</div>
<div class="section" id="nonce">
<h3>Nonce<a class="headerlink" href="#nonce" title="Permalink to this headline">¶</a></h3>
<p>The 24-byte nonce (<a class="reference external" href="https://en.wikipedia.org/wiki/Cryptographic_nonce">Number used once</a>)
given to <a class="reference internal" href="#nacl.secret.SecretBox.encrypt" title="nacl.secret.SecretBox.encrypt"><code class="xref py py-meth docutils literal notranslate"><span class="pre">encrypt()</span></code></a> and
<a class="reference internal" href="#nacl.secret.SecretBox.decrypt" title="nacl.secret.SecretBox.decrypt"><code class="xref py py-meth docutils literal notranslate"><span class="pre">decrypt()</span></code></a> must <strong>NEVER</strong> be reused for a
particular key. Reusing a nonce may give an attacker enough information to
decrypt or forge other messages. A nonce is not considered secret and may be
freely transmitted or stored in plaintext alongside the ciphertext.</p>
<p>A nonce does not need to be random or unpredictable, nor does the method of
generating them need to be secret. A nonce could simply be a counter
incremented with each message encrypted, which can be useful in
connection-oriented protocols to reject duplicate messages (“replay
attacks”). A bidirectional connection could use the same key for both
directions, as long as their nonces never overlap (e.g. one direction always
sets the high bit to “1”, the other always sets it to “0”).</p>
<p>If you use a counter-based nonce along with a key that is persisted from one
session to another (e.g. saved to disk), you must store the counter along
with the key, to avoid accidental nonce reuse on the next session. For this
reason, many protocols derive a new key for each session, reset the counter
to zero with each new key, and never store the derived key or the counter.</p>
<p>You can safely generate random nonces by calling
<a class="reference internal" href="utils.html#nacl.utils.random" title="nacl.utils.random"><code class="xref py py-func docutils literal notranslate"><span class="pre">random()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">SecretBox.NONCE_SIZE</span></code>.</p>
</div>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="nacl.secret.SecretBox">
<em class="property">class </em><code class="sig-prename descclassname">nacl.secret.</code><code class="sig-name descname">SecretBox</code><span class="sig-paren">(</span><em class="sig-param">key</em>, <em class="sig-param">encoder</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nacl/secret.html#SecretBox"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nacl.secret.SecretBox" title="Permalink to this definition">¶</a></dt>
<dd><p>The SecretBox class encrypts and decrypts messages using the given secret
key.</p>
<p>The ciphertexts generated by <code class="xref py py-class docutils literal notranslate"><span class="pre">Secretbox</span></code> include a 16
byte authenticator which is checked as part of the decryption. An invalid
authenticator will cause the decrypt function to raise an exception. The
authenticator is not a signature. Once you’ve decrypted the message you’ve
demonstrated the ability to create arbitrary valid message, so messages you
send are repudiable. For non-repudiable messages, sign them after
encryption.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – The secret key used to encrypt and decrypt messages.</p></li>
<li><p><strong>encoder</strong> – A class that is able to decode the <code class="docutils literal notranslate"><span class="pre">key</span></code>.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="nacl.secret.SecretBox.encrypt">
<code class="sig-name descname">encrypt</code><span class="sig-paren">(</span><em class="sig-param">plaintext</em>, <em class="sig-param">nonce</em>, <em class="sig-param">encoder</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nacl/secret.html#SecretBox.encrypt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nacl.secret.SecretBox.encrypt" title="Permalink to this definition">¶</a></dt>
<dd><p>Encrypts the plaintext message using the given <cite>nonce</cite> (or generates
one randomly if omitted) and returns the ciphertext encoded with the
encoder.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is <strong>VITALLY</strong> important that the nonce is a nonce,
i.e. it is a number used only once for any given key. If you fail
to do this, you compromise the privacy of the messages encrypted.
Give your nonces a different prefix, or have one side use an odd
counter and one an even counter. Just make sure they are different.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>plaintext</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – The plaintext message to encrypt.</p></li>
<li><p><strong>nonce</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – The nonce to use in the encryption.</p></li>
<li><p><strong>encoder</strong> – A class that is able to decode the ciphertext.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An instance of <a class="reference internal" href="utils.html#nacl.utils.EncryptedMessage" title="nacl.utils.EncryptedMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">EncryptedMessage</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="nacl.secret.SecretBox.decrypt">
<code class="sig-name descname">decrypt</code><span class="sig-paren">(</span><em class="sig-param">ciphertext</em>, <em class="sig-param">nonce</em>, <em class="sig-param">encoder</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nacl/secret.html#SecretBox.decrypt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nacl.secret.SecretBox.decrypt" title="Permalink to this definition">¶</a></dt>
<dd><p>Decrypts the ciphertext using the <cite>nonce</cite> (explicitly, when passed as a
parameter or implicitly, when omitted, as part of the ciphertext) and
returns the plaintext message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ciphertext</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – The encrypted message to decrypt.</p></li>
<li><p><strong>nonce</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – The nonce to use in the decryption.</p></li>
<li><p><strong>encoder</strong> – A class that is able to decode the plaintext.</p></li>
</ul>
</dd>
<dt class="field-even">Return bytes</dt>
<dd class="field-even"><p>The decrypted plaintext.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="algorithm-details">
<h2>Algorithm details<a class="headerlink" href="#algorithm-details" title="Permalink to this headline">¶</a></h2>
<dl class="field-list simple">
<dt class="field-odd">Encryption</dt>
<dd class="field-odd"><p><a class="reference external" href="https://libsodium.gitbook.io/doc/advanced/stream_ciphers/xsalsa20">XSalsa20 stream cipher</a></p>
</dd>
<dt class="field-even">Authentication</dt>
<dd class="field-even"><p><a class="reference external" href="https://en.wikipedia.org/wiki/Poly1305-AES">Poly1305 MAC</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="signing.html" class="btn btn-neutral float-right" title="Digital Signatures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="public.html" class="btn btn-neutral float-left" title="Public Key Encryption" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Donald Stufft and Individual Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>